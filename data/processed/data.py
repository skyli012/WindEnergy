import numpy as np
import pandas as pd
from shapely.geometry import Point, shape
import json

# -----------------------------
# 1️⃣ 读取 GeoJSON 并提取 Polygon
# -----------------------------
geojson_data = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "coordinates": [
          [
              [
                  35.34055168964275,
                  32.51848247177543
              ],
              [
                  35.3413041716567,
                  32.51885289140617
              ],
              [
                  35.34223550740023,
                  32.51914457969605
              ],
              [
                  35.343977580190256,
                  32.519271416826754
              ],
              [
                  35.34768240559822,
                  32.51857209667003
              ],
              [
                  35.34981081027138,
                  32.518105531420176
              ],
              [
                  35.35175637171179,
                  32.51865536622297
              ],
              [
                  35.356562023616505,
                  32.518737265297375
              ],
              [
                  35.359978749578175,
                  32.51772467485671
              ],
              [
                  35.36514433789122,
                  32.516952665423716
              ],
              [
                  35.37030904661711,
                  32.51516511669995
              ],
              [
                  35.37337974791859,
                  32.513210256436
              ],
              [
                  35.38066671240654,
                  32.50939914687423
              ],
              [
                  35.382876749338436,
                  32.50683807311724
              ],
              [
                  35.38563717496618,
                  32.50528999030571
              ],
              [
                  35.38950514620524,
                  32.50529177372839
              ],
              [
                  35.39644690828629,
                  32.5027897640032
              ],
              [
                  35.400408782470095,
                  32.50216814868216
              ],
              [
                  35.40280369122911,
                  32.50154796210461
              ],
              [
                  35.404459751525536,
                  32.49922106890111
              ],
              [
                  35.40418048591965,
                  32.495891707110076
              ],
              [
                  35.404179649110546,
                  32.4940328587449
              ],
              [
                  35.40592954625893,
                  32.489069006404534
              ],
              [
                  35.407028335633754,
                  32.48495589967321
              ],
              [
                  35.40684476286219,
                  32.4835596169288
              ],
              [
                  35.40795000791968,
                  32.48038106237301
              ],
              [
                  35.41043220674251,
                  32.47580133706745
              ],
              [
                  35.412547102226426,
                  32.472997566402455
              ],
              [
                  35.41438848156423,
                  32.470031602964454
              ],
              [
                  35.41972039243785,
                  32.47068381097111
              ],
              [
                  35.42504948706838,
                  32.47131157620973
              ],
              [
                  35.43202247127664,
                  32.472399614149325
              ],
              [
                  35.43594480346471,
                  32.47415869729733
              ],
              [
                  35.43961980844307,
                  32.480063004525576
              ],
              [
                  35.44082821526138,
                  32.48403122102623
              ],
              [
                  35.441420206531774,
                  32.488346422332384
              ],
              [
                  35.441419673864914,
                  32.49345461913073
              ],
              [
                  35.441325788394096,
                  32.49628347425609
              ],
              [
                  35.438594357159445,
                  32.50020067962775
              ],
              [
                  35.435883330527616,
                  32.50545067181959
              ],
              [
                  35.43390822610576,
                  32.50981432519802
              ],
              [
                  35.43111147684027,
                  32.51299591967377
              ],
              [
                  35.42476759328454,
                  32.51611093116341
              ],
              [
                  35.417934440187565,
                  32.52081619365708
              ],
              [
                  35.41287488901645,
                  32.52374424338055
              ],
              [
                  35.40705892759863,
                  32.52571589921516
              ],
              [
                  35.401700193249155,
                  32.52635202526562
              ],
              [
                  35.395732853856316,
                  32.52830018321896
              ],
              [
                  35.39029406031872,
                  32.53014534605437
              ],
              [
                  35.386742329762455,
                  32.53084401305112
              ],
              [
                  35.38455355045366,
                  32.53224277781629
              ],
              [
                  35.38387699846476,
                  32.53497935275304
              ],
              [
                  35.38120995420479,
                  32.53952475407482
              ],
              [
                  35.37918220745857,
                  32.54138503954434
              ],
              [
                  35.374419382378846,
                  32.542682215671235
              ],
              [
                  35.37178150937058,
                  32.54428820908815
              ],
              [
                  35.370242750117114,
                  32.54530738231894
              ],
              [
                  35.36753160285946,
                  32.54586329011332
              ],
              [
                  35.36566311129002,
                  32.545832411649485
              ],
              [
                  35.36467390891258,
                  32.54521473589702
              ],
              [
                  35.364490723287275,
                  32.54465882408623
              ],
              [
                  35.364930368788634,
                  32.54397937164339
              ],
              [
                  35.36504028016324,
                  32.54252779692561
              ],
              [
                  35.36482045741258,
                  32.54119973992489
              ],
              [
                  35.36357480105937,
                  32.53956280651013
              ],
              [
                  35.3626955100566,
                  32.538111160393186
              ],
              [
                  35.36210931605521,
                  32.53764786414018
              ],
              [
                  35.360424008300384,
                  32.536937471909525
              ],
              [
                  35.358811974796225,
                  32.53625796103965
              ],
              [
                  35.35844560354556,
                  32.53564021942367
              ],
              [
                  35.3580792343312,
                  32.53400318333955
              ],
              [
                  35.35760295170445,
                  32.53174834928819
              ],
              [
                  35.35654048112522,
                  32.530080353571165
              ],
              [
                  35.353975882368985,
                  32.52804164990833
              ],
              [
                  35.350971638110025,
                  32.5265280369608
              ],
              [
                  35.34822385372843,
                  32.525415978545865
              ],
              [
                  35.34381196824691,
                  32.52508339251776
              ],
              [
                  35.343043217909496,
                  32.525057650166076
              ],
              [
                  35.34220472310918,
                  32.52481525590551
              ],
              [
                  35.341737561752154,
                  32.5244718629705
              ],
              [
                  35.3414979918245,
                  32.524290066179816
              ],
              [
                  35.34059960459871,
                  32.52413856857274
              ],
              [
                  35.339737152862256,
                  32.52411836887319
              ],
              [
                  35.338886680698266,
                  32.52418906767636
              ],
              [
                  35.337808616027075,
                  32.524209267360774
              ],
              [
                  35.337053970757495,
                  32.524148668293805
              ],
              [
                  35.33629932528703,
                  32.523987070670856
              ],
              [
                  35.336119647841514,
                  32.52379517301226
              ],
              [
                  35.335999861120456,
                  32.52331037816103
              ],
              [
                  35.335939968638314,
                  32.52293667952753
              ],
              [
                  35.33585611916419,
                  32.522744779625626
              ],
              [
                  35.33556863525175,
                  32.522381178687056
              ],
              [
                  35.33536500081337,
                  32.52196707582577
              ],
              [
                  35.335376979309814,
                  32.52155297105695
              ],
              [
                  35.33549676427319,
                  32.521219665832405
              ],
              [
                  35.33602381811244,
                  32.52075505648685
              ],
              [
                  35.33641910849272,
                  32.520219742741205
              ],
              [
                  35.336922205071545,
                  32.519623823207496
              ],
              [
                  35.33754508688128,
                  32.51916930601945
              ],
              [
                  35.33816796869192,
                  32.51883599195402
              ],
              [
                  35.338886678472164,
                  32.51865418376116
              ],
              [
                  35.34055168964275,
                  32.51848247177543
              ]
          ]
        ],
        "type": "Polygon"
      }
    }
  ]
}

polygon = shape(geojson_data['features'][0]['geometry'])

# -----------------------------
# 2️⃣ 在 Polygon 内生成随机点
# -----------------------------
n_points = 1000
rows = []

for _ in range(n_points):
    # 生成点
    while True:
        lon = np.random.uniform(polygon.bounds[0], polygon.bounds[2])
        lat = np.random.uniform(polygon.bounds[1], polygon.bounds[3])
        pt = Point(lon, lat)
        if polygon.contains(pt):
            break

    # 固定点的地理属性（但风速每小时变化）
    elevation = round(np.random.uniform(200, 500), 1)
    slope = round(np.random.uniform(0, 20), 1)
    grid_proximity = round(np.random.uniform(0.1, 1), 2)
    road_distance = round(np.random.uniform(50, 800), 1)
    residential_distance = round(np.random.uniform(100, 1200), 1)
    heritage_distance = round(np.random.uniform(100, 1500), 1)
    geology_distance = round(np.random.uniform(100, 1500), 1)
    water_distance = round(np.random.uniform(50, 1000), 1)
    cost = round(np.random.uniform(800, 1500), 1)

    # --------------------------
    # 3️⃣ 为每个点生成 24 小时风速
    # --------------------------
    for hour in range(24):
        # 生成风速波动，可以加入周期（早晚高，中午低）
        base = np.random.normal(7.5, 1.5)  # 基础风速
        daily_variation = 2 * np.sin(2 * np.pi * hour / 24)  # 周期变化（早晚高，中午弱）

        wind_speed = base + daily_variation
        wind_speed = np.clip(wind_speed, 4, 12)

        rows.append({
            "point_id": _,  # 用于标识每个点
            "hour": hour,   # 0~23 小时
            "lat": lat,
            "lon": lon,
            "elevation": elevation,
            "slope": slope,
            "predicted_wind_speed": round(wind_speed, 2),
            "grid_proximity": grid_proximity,
            "road_distance": road_distance,
            "residential_distance": residential_distance,
            "heritage_distance": heritage_distance,
            "geology_distance": geology_distance,
            "water_distance": water_distance,
            "cost": cost
        })

# -----------------------------
# 4️⃣ 保存为 CSV
# -----------------------------
df = pd.DataFrame(rows)
df.to_csv("maale_gilboa_24h_simulated_points.csv", index=False)

print("生成完成！24000 rows 已保存到 maale_gilboa_24h_simulated_points.csv")
